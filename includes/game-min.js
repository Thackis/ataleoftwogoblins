var playAreaW=640;var playAreaH=400;var moveAreaW=640;var moveAreaH=288;var dTimer=3000;var bgY=-64;var bgLF=+new Date;var flashLF=+new Date;var flashCountGap=Math.floor((Math.random()*10000)+5000);var flashed=false;var loadCount=0;var loadCountMax=100;var theOption;var lines,responses;var playerFlash=new Image();var npcFlash=new Image();var room="The Front Desk";var minimized=false;var pInteractArray=["Who ARE you?","What do you want from me!?","Why are you bothering me!?","STOP!"];var pInteractCount=0;var touchMoved=false;var isiOS=navigator.userAgent.indexOf("iPhone")!=-1||navigator.userAgent.indexOf("iPad")!=-1||navigator.userAgent.indexOf("iPod")!=-1;var isOpera=navigator.userAgent.indexOf("Opera")!=-1;var player={element:null,context:null,img:new Image(),imgFlash:new Image(),imgReady:false,imgFlashReady:false,dElement:null,dContext:null,dWidth:0,dHeight:19,dWLoc:150,dHLoc:120,dTimeOut:null,isSpeaking:false,isInteracting:false,dColor:"rgb(255, 255, 255)",offAreaText:"Nothing important over there.",moveDistance:16,w:64,h:192,mid:32,sx:0,sy:384,facing:"right",faceRight:true,faceLeft:false,faceForward:false,faceBack:false,counter:0,endStep:6,loc:0,lastFrame:+new Date,start:{rightX:0,leftX:64,forwardX:128,backX:192,y:384}};var isNpc=false;var npc={element:null,context:null,img:new Image(),imgFlash:new Image(),imgReady:false,imgFlashReady:false,dElement:null,dContext:null,dWidth:0,dHeight:19,dWLoc:150,dHLoc:80,dialogueLoc:150,dColor:"rgb(225, 218, 36)",dTimeOut:null,isSpeaking:false,w:100,h:105,mid:50,sx:0,sy:0,counter:0,endStep:2,loc:400,lastFrame:+new Date,start:{leftX:0,y:0}};var key={right:false,left:false};var click={right:true,left:false};var clickLocX=180;var clickLocY=0;(function(){var b=0;var c=["ms","moz","webkit","o"];for(var a=0;a<c.length&&!window.requestAnimationFrame;++a){window.requestAnimationFrame=window[c[a]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[c[a]+"CancelAnimationFrame"]||window[c[a]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(h,e){var d=new Date().getTime();var f=Math.max(0,16-(d-b));var g=window.setTimeout(function(){h(d+f)},f);b=d+f;return g}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(d){clearTimeout(d)}}}());if(!Date.now){Date.now=function now(){return +(new Date)}}function getCursorPosition(b){var a;var c;if(b.pageX&&b.pageY){a=b.pageX;c=b.pageY}else{if(b.changedTouches[0].pageX){a=b.changedTouches[0].pageX;c=b.changedTouches[0].pageY}else{a=b.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;c=b.clientY+document.body.scrollTop+document.documentElement.scrollTop}}a-=document.getElementById("gameArea").offsetLeft;c-=document.getElementById("gameArea").offsetTop;if(!player.isInteracting&&isNpc){switch(room){case"The Front Desk":if(a>20&&a<120&&c>171&&c<241){a=120;clickLocX=a;clickLocY=c;player.facing="left";player.isInteracting=true;click.right=false;click.left=false;key.right=false;key.left=false;clearDialogueText(player,false);interact();return true}break;default:if(a>400&&a<500&&c>171&&c<241){a=410;clickLocX=a;clickLocY=c;player.facing="right";player.isInteracting=true;click.right=false;click.left=false;key.right=false;key.left=false;clearDialogueText(player,false);interact();return true}break}}else{if(player.isInteracting){if(a>=0&&a<=moveAreaW){if(c>288&&c<=400){theOption=Math.floor((c-288)/35)+1;interact()}else{player.isInteracting=false;interact()}}else{player.isInteracting=false;interact()}}}if(!player.isInteracting&&c>=0&&c<=playAreaH){if(a>=0){if(a<=moveAreaW){clickLocX=a;clickLocY=c;if(c<=moveAreaH){return true}else{return false}}else{player.facing="right";drawDialogueText(player,player.offAreaText);click.right=false;click.left=false;key.right=false;key.left=false}}else{player.facing="left";drawDialogueText(player,player.offAreaText);click.right=false;click.left=false;key.right=false;key.left=false}}return false}function drawDialogueOptions(a){var c=document.getElementById("dialogueOptions");var b=c.getContext("2d");b.clearRect(0,0,640,112);if(a){return}b.font="normal 16px 'Press Start 2P'";b.textBaseline="top";b.fillStyle="rgb(0, 153, 0)";b.fillText(lines[0],0,0);b.fillText(lines[1],0,35);b.fillText(lines[2],0,70)}function drawMultiDialogueText(d,b,i,a){d.dContext.font="normal 16px 'Press Start 2P'";d.dContext.textBaseline="top";d.dContext.shadowBlur=0;d.dContext.shadowColor="rgba(0, 0, 0, 1)";var e=d.dContext.measureText(b[i][a]).width+3;var c=Math.round(e/2);var f=(d.loc+d.mid)-c;if(f<0){f=0}if((f+e)>playAreaW){f=playAreaW-e}d.dElement.style.left=f+"px";d.dElement.style.top=d.dHLoc+"px";d.dWidth=e;d.dElement.width=d.dWidth;clearDialogueText(player,npc);d.dContext.font="normal 16px 'Press Start 2P'";d.dContext.textBaseline="top";d.dContext.shadowBlur=0;d.dContext.shadowColor="rgba(0, 0, 0, 1)";d.dContext.fillStyle=d.dColor;var h=-1;var g=-1;if(isOpera){h=-2;g=-2}d.dContext.shadowOffsetX=1;d.dContext.shadowOffsetY=1;d.dContext.fillText(b[i][a],1,1);d.dContext.shadowOffsetX=h;d.dContext.shadowOffsetY=g;d.dContext.fillText(b[i][a],1,1);d.dContext.shadowOffsetX=1;d.dContext.shadowOffsetY=g;d.dContext.fillText(b[i][a],1,1);d.dContext.shadowOffsetX=h;d.dContext.shadowOffsetY=1;d.dContext.fillText(b[i][a],1,1);d.dContext.shadowOffsetX=2;d.dContext.shadowOffsetY=2;d.dContext.fillText(b[i][a],1,1);d.isSpeaking=true;if(a<responses[i].length){a++;d.dTimeOut=setTimeout(function(){drawMultiDialogueText(d,b,i,a)},dTimer)}else{clearDialogueText(d,false)}}function drawDialogueText(c,f){c.dContext.font="normal 16px 'Press Start 2P'";c.dContext.textBaseline="top";c.dContext.shadowBlur=0;c.dContext.shadowColor="rgba(0, 0, 0, 1)";var e=c.dContext.measureText(f).width+3;var g=Math.round(e/2);var b=(c.loc+c.mid)-g;if(b<0){b=0}if((b+e)>playAreaW){b=playAreaW-e}c.dElement.style.left=b+"px";c.dElement.style.top=c.dHLoc+"px";clearTimeout(c.dTimeOut);c.dWidth=e;c.dElement.width=c.dWidth;c.dContext.clearRect(0,0,c.dWidth,c.dHeight);c.dContext.font="normal 16px 'Press Start 2P'";c.dContext.textBaseline="top";c.dContext.shadowBlur=0;c.dContext.shadowColor="rgba(0, 0, 0, 1)";c.dContext.fillStyle=c.dColor;var d=-1;var a=-1;if(isOpera){d=-2;a=-2}c.dContext.shadowOffsetX=1;c.dContext.shadowOffsetY=1;c.dContext.fillText(f,1,1);c.dContext.shadowOffsetX=d;c.dContext.shadowOffsetY=a;c.dContext.fillText(f,1,1);c.dContext.shadowOffsetX=1;c.dContext.shadowOffsetY=a;c.dContext.fillText(f,1,1);c.dContext.shadowOffsetX=d;c.dContext.shadowOffsetY=1;c.dContext.fillText(f,1,1);c.dContext.shadowOffsetX=2;c.dContext.shadowOffsetY=2;c.dContext.fillText(f,1,1);c.isSpeaking=true;c.dTimeOut=setTimeout(function(){clearDialogueText(c,false)},dTimer)}function clearDialogueText(a,b){if(a){clearTimeout(a.dTimeOut);a.dContext.clearRect(0,0,a.dWidth,a.dHeight);a.isSpeaking=false}if(b){clearTimeout(b.dTimeOut);b.dContext.clearRect(0,0,b.dWidth,b.dHeight);b.isSpeaking=false}}function animateSprite(a,b){var c=b*a.h;if(a.counter>=a.endStep){a.sx=0;a.counter=0}else{if(a.sy==a.start.y){a.sx=0}else{if(a.sy==c){a.sx+=a.w}}a.sy=c}a.counter++}function reset(a){a.sy=a.start.y;a.counter=0;renderSprite(a)}function renderSprite(a){a.context.clearRect(0,0,a.w,a.h);a.context.drawImage(a.img,a.sx,a.sy,a.w,a.h,0,0,a.w,a.h);a.lastFrame=Date.now()}function drawSprite(a){if(a.isSpeaking){animateSprite(a,1)}else{npc.sx=npc.start.leftX;reset(a)}renderSprite(npc)}function drawPSprite(){var b=player.dElement.width;var c=Math.round(b/2);var a=(player.loc+player.mid)-c;if(a<0){a=0}if((a+b)>playAreaW){a=playAreaW-b}if(click.right){if(player.loc<clickLocX-player.mid){animateSprite(player,0);player.loc+=player.moveDistance;player.element.style.left=player.loc+"px";player.dElement.style.left=a+"px"}else{click.right=false}}if(click.left){if(player.loc>clickLocX-player.mid){animateSprite(player,1);player.loc-=player.moveDistance;player.element.style.left=player.loc+"px";player.dElement.style.left=a+"px"}else{click.left=false}}if(key.right){if(player.loc<=playAreaW-player.w-player.moveDistance){animateSprite(player,0);player.loc+=player.moveDistance;player.element.style.left=player.loc+"px";player.dElement.style.left=a+"px"}else{drawDialogueText(player,player.offAreaText);player.sx=player.start.rightX;reset(player)}}if(key.left){if(player.loc>=player.moveDistance){animateSprite(player,1);player.loc-=player.moveDistance;player.element.style.left=player.loc+"px";player.dElement.style.left=a+"px"}else{drawDialogueText(player,player.offAreaText);player.sx=player.start.leftX;reset(player)}}if(!click.right&&!key.right&&!click.left&&!key.left){if(player.facing=="right"){if(player.isSpeaking){animateSprite(player,3)}else{player.sx=player.start.rightX;reset(player)}}if(player.facing=="left"){if(player.isSpeaking){animateSprite(player,4)}else{player.sx=player.start.leftX;reset(player)}}if(player.facing=="forward"){if(player.isSpeaking){animateSprite(player,5)}else{player.sx=player.start.forwardX;reset(player)}}if(player.facing=="back"){if(player.isSpeaking){animateSprite(player,6)}else{player.sx=player.start.backX;reset(player)}}}renderSprite(player)}function touchMove(){touchMoved=true}function leftClick(b){var a=getCursorPosition(b);if(!touchMoved){if(a){if(clickLocX>player.loc){click.right=true;player.facing="right"}else{click.left=true;player.facing="left"}}}touchMoved=false}function keyDown(a){if(!player.isInteracting){switch(a.keyCode){case 68:key.right=true;click.right=false;click.left=false;player.facing="right";break;case 65:key.left=true;click.right=false;click.left=false;player.facing="left";break;case 112:a.preventDefault();player.facing="forward";drawDialogueText(player,"Help?! In a web game?");click.right=false;click.left=false;key.right=false;key.left=false;return false;break;case 116:a.preventDefault();player.facing="forward";drawDialogueText(player,"Save?! In a web game?");click.right=false;click.left=false;key.right=false;key.left=false;return false;break;case 83:player.facing="forward";playerInteract();click.right=false;click.left=false;key.right=false;key.left=false;break;case 87:player.facing="back";drawDialogueText(player,"Yuck! What a wet mess!");click.right=false;click.left=false;key.right=false;key.left=false;break;default:break}}}function keyUp(a){if(a.keyCode==68){key.right=false;click.right=false;click.left=false}else{if(a.keyCode==65){key.left=false;click.right=false;click.left=false}}}function update(){if(!minimized){requestAnimationFrame(update)}var b=Date.now();var a=b-player.lastFrame;var e=b-flashLF;var c=b-bgLF;var d=b-npc.lastFrame;if(e>=flashCountGap&&!flashed){playerFlash=player.img;player.img=player.imgFlash;drawPSprite();if(isNpc){npcFlash=npc.img;npc.img=npc.imgFlash;drawSprite(npc)}if(room!="The Lab"){document.getElementById("glass").style.backgroundImage="url('images/glass_flash.png')"}if(room!="The Gallery"){document.getElementById("navArrow").style.backgroundImage="url('images/ui_icons_flash.png')"}document.getElementById("logo").style.backgroundImage="url('images/ui_icons_flash.png')";document.getElementById("location").style.backgroundImage="url('images/ui_icons_flash.png')";document.getElementById("location").style.color="#000";document.getElementById("nav").style.backgroundImage="url('images/ui_icons_flash.png')";switch(room){case"The Front Desk":document.getElementById("floor").style.backgroundImage="url('images/floor_flash.png')";break;case"The Archives":document.getElementById("archives").style.backgroundImage="url('images/archives_flash.png')";document.getElementById("floorNon").style.backgroundImage="url('images/floor_non_flash.png')";break;case"The Elevator":document.getElementById("floor").style.backgroundImage="url('images/floor_flash.png')";break;case"The Gallery":document.getElementById("navAltArrow").style.backgroundImage="url('images/ui_icons_flash.png')";document.getElementById("floor").style.backgroundImage="url('images/floor_flash.png')";break;case"The Office":document.getElementById("blinds").style.backgroundImage="url('images/blinds_flash.png')";document.getElementById("floorBlinds").style.backgroundImage="url('images/floor_blinds_flash.png')";break;case"The Lab":document.getElementById("glassBroken").style.backgroundImage="url('images/glass_flash.png')";document.getElementById("glassBroken").style.backgroundRepeat="repeat";document.getElementById("floorBroken").style.backgroundImage="url('images/floor_flash.png')";document.getElementById("floorBroken").style.backgroundRepeat="repeat";break;default:break}flashCountGap=Math.floor((Math.random()*10000)+5000);flashed=true;flashLF=b}else{if(flashed&&e>=250){player.img=playerFlash;drawPSprite();if(isNpc){npc.img=npcFlash;drawSprite(npc)}if(room!="The Lab"){document.getElementById("glass").style.backgroundImage="url('images/glass.png')"}if(room!="The Gallery"){document.getElementById("navArrow").style.backgroundImage="url('images/ui_icons.png')"}document.getElementById("logo").style.backgroundImage="url('images/ui_icons.png')";document.getElementById("location").style.backgroundImage="url('images/ui_icons.png')";document.getElementById("location").style.color="#4fa05d";document.getElementById("nav").style.backgroundImage="url('images/ui_icons.png')";switch(room){case"The Front Desk":document.getElementById("floor").style.backgroundImage="url('images/floor.png')";break;case"The Archives":document.getElementById("archives").style.backgroundImage="url('images/archives.png')";document.getElementById("floorNon").style.backgroundImage="url('images/floor_non.png')";break;case"The Elevator":document.getElementById("floor").style.backgroundImage="url('images/floor.png')";break;case"The Gallery":document.getElementById("navAltArrow").style.backgroundImage="url('images/ui_icons.png')";document.getElementById("floor").style.backgroundImage="url('images/floor.png')";break;case"The Office":document.getElementById("blinds").style.backgroundImage="url('images/blinds.png')";document.getElementById("floorBlinds").style.backgroundImage="url('images/floor_blinds.png')";break;case"The Lab":document.getElementById("glassBroken").style.backgroundImage="url('images/lab_glass.png')";document.getElementById("glassBroken").style.backgroundRepeat="no-repeat";document.getElementById("floorBroken").style.backgroundImage="url('images/floor_broken.png')";document.getElementById("floorBroken").style.backgroundRepeat="no-repeat";break;default:break}flashed=false}}if(a>=167){drawPSprite()}if(isNpc){if(d>=167){drawSprite(npc)}}if(!Modernizr.cssanimations){if(c>=18){bgY+=4;if(bgY>0){bgY=-64}document.getElementById("rain").style.backgroundPosition="0px "+bgY+"px";document.getElementById("floorRef").style.backgroundPosition="0px "+-bgY+"px"}}}function openSeq(){if(loadCount>=loadCountMax){drawDialogueText(player,room);player.context.globalAlpha=1;roomIsReady=true;requestAnimationFrame(update);window.addEventListener("keydown",keyDown,false);window.addEventListener("keyup",keyUp,false);window.addEventListener("click",leftClick,false);window.addEventListener("touchend",leftClick,false);window.addEventListener("touchmove",touchMove,false)}else{requestAnimationFrame(roomStart);var b=Date.now();var a=b-player.lastFrame;loadCount++;player.context.globalAlpha=loadCount/100;if(a>=167){drawPSprite()}}}function roomStart(){if(isNpc){if(player.imgReady&&player.imgFlashReady&&npc.imgReady&&npc.imgFlashReady){renderSprite(npc);openSeq()}}else{if(player.imgReady&&player.imgFlashReady){openSeq()}}}function init(a){if(Modernizr.canvas&&Modernizr.canvastext){room=a;if(room=="The Front Desk"||room=="The Lab"||room=="The Archives"){isNpc=true}player.element=document.getElementById("pSprite");player.dElement=document.getElementById("pDialogue");if(player.element.getContext){player.context=player.element.getContext("2d");player.dContext=player.dElement.getContext("2d")}else{toggleMode();getElementById("gameControls").style.visibility="hidden"}player.img.src="images/detective_ss.png";player.imgFlash.src="images/detective_ss_flash.png";player.img.onload=function(){player.imgReady=true;roomStart()};player.imgFlash.onload=function(){player.imgFlashReady=true;roomStart()};if(isNpc){npc.element=document.getElementById("npcSprite");npc.dElement=document.getElementById("npcDialogue");if(npc.element.getContext){npc.context=npc.element.getContext("2d");npc.dContext=npc.dElement.getContext("2d")}else{toggleMode();getElementById("gameControls").style.visibility="hidden"}switch(room){case"The Front Desk":npc.img.src="images/receptionist.png";npc.imgFlash.src="images/receptionist_flash.png";npc.element.style.left="20px";npc.loc=20;lines=["What is this place?","Did you hear about the accident?","Tell me about The Master Goblin"];responses=[["GGS is a game development studio…","We focus on creating unique games…","in the adventure and RPG space."],["Oh, isn’t it terrible?…","He was working so hard…","I bet he was pushed!…","He doesn’t get along well with…","THE GOBLIN MASTERMIND!"],["He is the man behind the company…","He’s a fighter! He won’t give up!…","Surviving that fall just proves it!…","Give him some time and you’ll see…","great things, I know it!"]];break;case"The Lab":npc.img.src="images/developer.png";npc.imgFlash.src="images/developer_flash.png";npc.dColor="rgb(200, 255, 200)";lines=["A little sassy are we?","What happened here?","Tell me about The Goblin Duo"];responses=[["You would be too if that fucker…","had left you with all the work."],["That fucker fell out the window…","Can’t you see that?…","Leaving me with all the work!"],["The Master Goblin is the creator…","that fucker!…","The Goblin Mastermind is the destroyer…","that bastard!…","Together they are…","the heart and mind of this company…","Dicks!…","Perpetually at war, they either…","make or break this company…","Then they leave all the work to me!…","fuckers!"]];break;case"The Archives":npc.img.src="images/archivist.png";npc.imgFlash.src="images/archivist_flash.png";npc.dColor="rgb(206, 117, 85)";lines=["What has the studio produced before?","What has changed?","Tell me about The Goblin Mastermind?"];responses=[["Nothing publicly available…","Though we do have thousands of records…","of titles, notes, systems, concepts,…","partial mockups, code, you name it."],["The Master Goblin made a bid to oust…","The Goblin Mastermind…","He is determined to make…","this company a success…","and end the war between them."],["He is the other to The Master Goblin…","The cunning, conniving, manipulative…","evil CEO of the studio."]];break;default:isNpc=false}npc.img.onload=function(){npc.imgReady=true;roomStart()};npc.imgFlash.onload=function(){npc.imgFlashReady=true;roomStart()}}if(isiOS){window.addEventListener("orientationchange",hideAddressBar,false);if(!window.pageYOffset){hideAddressBar()}}}}function playerInteract(){drawDialogueText(player,pInteractArray[pInteractCount]);if(pInteractCount<pInteractArray.length-1){pInteractCount++}else{pInteractCount=0}}function toggleVisibility(b){var a=document.getElementById(b);if(a.style.visibility=="visible"){a.style.visibility="hidden"}else{a.style.visibility="visible"}}function toggleMode(){if(!minimized){document.getElementById("min_max").style.backgroundPosition="-244px -44px";document.documentElement.className+=" minimized";minimized=true}else{document.getElementById("min_max").style.backgroundPosition="-200px -44px";document.documentElement.className=document.documentElement.className.replace(/(?:^|\s)minimized(?!\S)/,"");minimized=false;requestAnimationFrame(update)}}function hideAddressBar(){if(!window.location.hash){if(document.height<window.outerHeight){document.body.style.height=(window.outerHeight+50)+"px"}setTimeout(function(){window.scrollTo(0,1)},50)}}function interact(){if(player.isInteracting){switch(room){case"The Front Desk":drawDialogueText(npc,"Welcome to Goblin Garage Studios!");if(theOption){drawMultiDialogueText(npc,responses,theOption-1,0);theOption=null}break;case"The Lab":drawDialogueText(npc,"WHAT!?");if(theOption){drawMultiDialogueText(npc,responses,theOption-1,0);theOption=null}break;case"The Gallery":break;case"The Office":break;case"The Archives":drawDialogueText(npc,"Yes?");if(theOption){drawMultiDialogueText(npc,responses,theOption-1,0);theOption=null}break;case"The Elevator":break;default:break}drawDialogueOptions(false)}else{drawDialogueOptions(true);clearDialogueText(player,npc)}};